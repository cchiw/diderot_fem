\section{Bugs in FEMprime branch}

\begin{description}[noitemsep]
\item[issue]- top level description
\item[computation]- operators and arguments
\item[output]-terminal output (if helpful)
\item[solution]- how was it solved 
\item[details]- of problem
\item[versions] svn version  scope (error-solved)
\end{description}

Sections with * indicates the bug still needs to be better understood.
\subsection{F1*}
\begin{description}[noitemsep]
\item[issue]- Code generation issue when converting types
\item[computation]-$|(\nabla(F0))|;$\
\item[output].\\
\begin{lstlisting}[mathescape=true]
ex1.cxx:798:16: error: no viable conversion from 'ex1::tensor\_ref\_2' to 'double'
        double l\_probe\_l\_4\_22 = makeEval\_UnitSquareMesh\_Lagrange\_2\_1(
               ^                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
***rtn:compile \_\_p\_o25\_o6\_t1\_tN\_tN\_\_l2
\end{lstlisting}
\item[solution]-?
\item[details]
\end{description}


\subsection{F2*}
\begin{description}[noitemsep]
\item[issue] Numerical error  when taking the norm.
\item[computation] $normalize(\nabla(F0))$
\item[output]
\item[solution]
\item[details]
\end{description}

 
\subsection{F3} 
\begin{description}[noitemsep]
\item[issue] Missing support for inner/cross product on ofields
\item[computation]
\item[output]
\item[solution] Add ofields (inner product) to typechecker
\item[details] Can not take inner-product of ofields 
\end{description}



\subsection{F4} 
\begin{description}[noitemsep]
\item[issue] Multiple creation of functions with the same name
\item[computation] gradient of a field minus another field
\item[output] terminal\\
\begin{lstlisting}[mathescape=true]
ex1.cxx:423:17: error: redefinition of 'helpEvalBasis\_UnitSquareMesh\_Lagrange\_2'
inline double * helpEvalBasis\_UnitSquareMesh\_Lagrange\_2(const double *k...
\end{lstlisting}
\item[solution] Fixed in r5413: the solution was to realize that the gradient of a field and a field incorrectly both generated common functions and stop this.
\item[details]
\end{description}




\subsection{F5*}
\begin{description}[noitemsep]
\item[issue]
\item[computation]
\item[output] terminal.\\
\begin{lstlisting}[mathescape=true]
3pow TIλ(T0[])<(T0)^2>HighToMid.expandOp: error converting InsideFEM<3>
uncaught exception Bind [nonexhaustive binding failure]
  raised at common/phase-timer.sml:78.57-78.59
  raised at high-to-mid/high-to-mid.sml:203.105-203.107
  raised at high-to-mid/buil
  \end{lstlisting}
\item[solution]
\item[details] Inside Error
\end{description}


  
\subsection{F6}
\begin{description}[noitemsep]
\item[issue] Translation in compiler EIN IR for Summation not handled
\item[computation]
\item[output] terminal.\\
\begin{lstlisting}[mathescape=true]
3HighToMid.expandEINAPP: error converting out051A = λ(F0[3],FNCSPACE1,FNCSPACE2,T3[3])<Probe(BuildFEM(T0)\_1[2]∇\_{i0,i1}),T3)> (FF004AB, VF004AE, pathF004B1, pos0421)
uncaught exception Subscript [subscript out of bounds]
  raised at common/phase-timer.sml:78.57-78.59
  raised at high-to-mid/high-to-mid.sml:216.7-216.9
  raised at Basis/Implementation/list.sml:78.35-78.44
make: *** [ex1.o] Error 1
cp: ex1.cxx: No such file or directory
cp: ex1.cxx: No such file or directory
***rtn:compile \_\_p\_o24\_o1\_t2\_t2\_\_l2
	 -: trace(hessian)
	-\_F\_s\_d3 |p\_o24\_o1\_t2\_t2\_\_l2
	rtn:compile 
	  \end{lstlisting}
\item[solution]
\item[details]
Summation in a single term not handled correctly
\end{description}


\subsection{F7*} 
\begin{description}[noitemsep]
\item[issue]conversion of types done incorrectly 
\item[computation]
\item[output] terminal.\\
\begin{lstlisting}[mathescape=true]
	  ex1.cxx:870:6: error: no type named 'tensor\_ref\_3\_3' in namespace 'ex1'
ex1::tensor\_ref\_3\_3 s\_makeEval\_UnitCubeMesh\_P\_4\_2(NodeTy nodes, newposTy b, coordTy c,int cell,MappTy nM, FloatMapTy pM){
~~~~~^
ex1.cxx:876:14: error:
\end{lstlisting}
\item[solution]
\item[details]
\end{description}
\subsection{F8}
\begin{description}[noitemsep]
\item[issue]Differential indices are constants
\item[computation]det(concat2)
\item[output] terminal.
\begin{lstlisting}[mathescape=true]
λ(F0[2],FNCSPACE1,FNCSPACE2,T3[3])<Probe(BuildFEM(T0\_{'0'})\_1[2]),T3)>
\end{lstlisting}
\item[details] Unhandled cases when using constant indices.Constant indices in field components
\item[solution]
\end{description}

\subsection{F9*}
\begin{description}[noitemsep]
\item[issue] Weird indexing tensors
\item[computation]
\item[output] terminal.\\
\begin{lstlisting}[mathescape=true]
ex1.cxx:850:20: error: subscripted value is not an array, pointer, or vector
        H[0][0][0] = H0[0][0];
                     ~~~~~^~
ex1.cxx:851:20: error: subscripted value is not an array, pointer, or vector
        H[0][1][0] = H0[1][0];
\end{lstlisting}
\item[solution]
\item[details]
\end{description}

\subsection{F10}
\begin{description}[noitemsep]
\item[issue]	Issue unknown 
\item[computation]
\item[output] terminal.\\
\begin{lstlisting}[mathescape=true]     	
-p\_o8\_o24\_t12\_t2\_\_l2 hessian(addition)| F\_s\_d3,F\_s\_d3| 
Rst: Z-3 RD  max diff: 51.5896 sumdiff: 13.9962 67.4956% c:24.8443995169280 o:76.43399
    	\end{lstlisting}
\item[solution]
\item[details]
\end{description}

	\subsection{F11*}
    	
	\subsection{F12}
	\begin{description}[noitemsep]
\item[issue]
\item[computation]
\item[output]
\item[solution]
\item[details]
\end{description}
		\begin{lstlisting}[mathescape=true]
uncaught exception Fail [Fail: unknown type]
  raised at common/phase-timer.sml:78.57-78.59
  raised at driver/main.sml:84.76-84.79
  raised at typechecker/check-expr.sml:611.47-611.66
make: *** [ex1.o] Error 1
cp: ex1.cxx: No such file or directory
cp: ex1.cxx: No such file or directory


***rtn:compile \_\_p\_o23\_o29\_t2\_tN\_tN\_\_l2
	 -: slicev0(grad)
	-\_F\_s\_d3 |p\_o23\_o29\_t2\_tN\_tN\_\_l2
	rtn:compile 
	\end{lstlisting}
\subsection{F13}
\begin{description}[noitemsep]
\item[issue] Unknown
\item[computation]
\item[output]
Weird allocation error\\
\begin{lstlisting}[mathescape=true]
python(24510,0x7fff796c2300) malloc: *** error for object 0x7ff48bbf7800: pointer being freed was not allocated
*** set a breakpoint in malloc\_error\_break to debug
[Charisees-MacBook-Air:24510] *** Process received signal ***
[Charisees-MacBook-Air:24510] Signal: Abort trap: 6 (6)
[Charisees-MacBook-Air:24510] Signal code:  (0)
[Charisees-MacBook-Air:24510] [ 0] 0   libsystem\_platform.dylib            0x00007fff88cd3f1a \_sigtramp + 26
[Charisees-MacBook-Air:24510] [ 1] 0   ???                                 0x0000000000000000 0x0 + 0
[Charisees-MacBook-Air:24510] [ 2] 0   libsystem\_c.dylib                   0x00007fff88d439a3 abort + 129
[Charisees-MacBook-Air:24510] [ 3] 0   libsystem\_malloc.dylib              0x00007fff8d8941cb free + 428
	\end{lstlisting}
\item[solution]
\item[details]
Error when creating a vector fields in python
\end{description}


	
\subsection{F15}
\begin{description}[noitemsep]
\item[issue]
\item[computation]
\item[output]teriminal\\.
\begin{lstlisting}[mathescape=true]
[0]PETSC ERROR: ------------------------------------------------------------------------
[0]PETSC ERROR: Caught signal number 11 SEGV: Segmentation Violation, probably memory access out of range
[0]PETSC ERROR: Try option -start_in_debugger or -on_error_attach_debugger
[0]PETSC ERROR: or see http://www.mcs.anl.gov/petsc/documentation/faq.html#valgrind
[0]PETSC ERROR: or try http://valgrind.org on GNU/linux and Apple Mac OS X to find memory corruption errors
[0]PETSC ERROR: configure using --with-debugging=yes, recompile, link, and run 
[0]PETSC ERROR: to get more information on the crash.
--------------------------------------------------------------------------

	\end{lstlisting}
\item[solution]
\item[details]

\end{description}


\subsection{F16}
\begin{description}[noitemsep]
\item[issue] Accidental sampling outside of a cell leads to a segfault in derivative code
\item[computation] Any level of differentiation and a sampling outside of the mesh will cause this error. 
\item[output] MPI reads out a segfault. 
\item[solution] Add check in the derivative code for outside of the mesh sampling
\item[details] Sampling at the point [0,9.45187e+06] led to a find cell error, which was handled correctly, but the derivative code did not handle this case and segfaulted. The reason it sampled to far away was a mistake in FATm. 
\end{description}

\subsection{F21}
\begin{description}[noitemsep]
\item[issue] Numerical error. 
\item[computation] Trace
\item[output] terminal\\
\begin{lstlisting}[mathescape=true]
***rtn:terrible\_\_p\_o0\_o6\_t16\_tN\_tN\_\_l2
	 -: trace(none)
	-
-p\_o0\_o6\_t16\_tN\_tN\_\_l2 trace(none)| F\_m2x2\_d2| 
		Rst: Z-3 RD  max diff: 7.486 sumdiff: 4.3919 172.2781% c:-3.14070000000000 o:4.3453002
	rtn:terrible
	\end{lstlisting}
\item[solution] splitting summation of probe. then creating own operator. shifting upper bound +1.
\item[details] Summation with indices in field component
\end{description}

\subsection{F22}
\begin{lstlisting}[mathescape=true]
-p\_o0\_o7\_t16\_tN\_\_l2 det(none)| F\_m2x2\_d2| Rst: V-0 RA
	\end{lstlisting}
Field component has two constant indices.
cutting function in float was not organizing indices correctly.

 python fem.py 3 0 7 23  (again with -3d case)
 

\subsection{F23}
\begin{lstlisting}[mathescape=true]
le \_\_p\_o0\_o8\_t16\_tN\_\_l2
	 -: inverse(none)
	 
1ex1.cxx:838:41: error: no matching function for call to 's\_2\_2makeEval\_UnitSquareMesh\_P\_2\_'
        tensor\_ref\_2\_2 l\_probe\_l\_4\_24 = s\_2\_2makeEval\_UnitSquareMesh\_P\_2\_(l\_node\_23, l\_newpos\_22, l\_coordinates\_14);
                                        ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
ex1.cxx:655:21: note: candidate function not viable: no known conversion from 'ex1::tensor\_ref\_2' to 'newposTy'
      (aka 'double *') for 2nd argument
ex1::tensor\_ref\_2\_2 s\_2\_2makeEval\_UnitSquareMesh\_P\_2\_(NodeTy nodes, newposTy b, coordTy c ){
                    ^
ex1.cxx:853:43: error: use of undeclared identifier 's\_2makeEval\_UnitSquareMesh\_P\_2\_'; did you mean
      's\_2\_2makeEval\_UnitSquareMesh\_P\_2\_'?
            tensor\_ref\_2 l\_probe\_l\_4\_33 = s\_2makeEval\_UnitSquareMesh\_P\_2\_(l\_node\_23, l\_newpos\_22, l\_coordinates\_14);
                                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                                          s\_2\_2makeEval\_UnitSquareMesh\_P\_2\_
	\end{lstlisting}


\subsection{F24}

\begin{description}
\item[Issue] Subtraction args are switched
\item[Computation] Subtracting one field from another
\item[Output]
  \begin{lstlisting}
    t\_\_p\_o0\_o10\_t14\_t14\_\_l2

observed data from femprime/ [[0.1088, -3.8392, -4.5563998], [-1.4155999, -2.8296001, -5.9981999], [3.6296, -7.6163998, -2.1338], [2.5702, -4.7568002, -1.7131], [1.8088, -5.2392001, -3.1064], [1.0176001, -4.3983998, -3.6528001], [1.5876, -5.9884, -3.9828]]

correct data from python[[-0.108800000000000, 3.83920000000000, 4.55640000000000], [1.41560000000000, 2.82960000000000, 5.99820000000000], [-3.62960000000000, 7.61640000000000, 2.13380000000000], [-2.57020000000000, 4.75680000000000, 1.71310000000000], [-1.80880000000000, 5.23920000000000, 3.10640000000000], [-1.01760000000000, 4.39840000000000, 3.65280000000000], [-1.58760000000000, 5.98840000000000, 3.98280000000000]]

 positions[[0.46, 0.38], [0.41, 0.14], [0.82, 0.63], [0.41, 0.87], [0.56, 0.58], [0.48, 0.52], [0.72, 0.43]]

Params(2)

-p\_o0\_o10\_t14\_t14\_\_l2 subtraction(none)| F\_v3\_d2,F\_v3\_d2| 
		Rst: Z-3 RD  max diff: 15.2328 sumdiff: 6.8524 200.0% c:7.61640000000000 o:-7.6163998


  \end{lstlisting}
\end{description}

\subsection{F25}

\begin{description}
\item[Issue] Code gen error
\item[Computation] Derivative of a tensor field i.e if you pass a tensor field from Firedrake and takes its derivative in Diderot
\item[Output]  It crashes warning of a double free. I don't have this on hand. Try the commit r5403 to see it. I forget the commit that fixed it
.\item[solution] Stopped any functions from delete memory allocated for newpos.
\item[details] Evaluation functions assumed that they were the last ones to get a bit of memory (the memory for the new position; allocated in the translate coordinates process) and so they delete it too soon.

\end{description}

\subsection{F26}

\begin{description}
\item[Issue] Code gen or floating point problem
\item[Computation] Regular pointwise evaluation
\item[Output] Numerically incorrect results on various combinations of points and FE data
\item[Solution] Kick the can by using doubles
\end{description}


\begin{description}

\item[F27]
 11/11/17
- double dot product missing between field and matrix \\
 python2 fem.py 4 1 15 17  5\\
compile issue\

[ex1.diderot:10.18-30] Error: type error for arguments of binary \\ operator ":"
  found: (OField\#4(2)[3,3] * mat3)
\item [F28]
- error with generated code names.
different sizes created same methods \\
for scalar field.
\item[F29]
11/26/17
- error with generated code names\\
differet names for affine (depends on space) for scalar and shape (even though no differences), but because it is derived when main constructor is different (isScalar)\\
affineDerv\_UnitSquareMesh\_P\_4\_1\_p
***rtn:compile \_\_p\_o12\_o35\_t39\_tN\_tN\_\_l2
	 -: jacob(division)
	-\_F\_v2\_d2,F\_s\_d2 |p\_o12\_o35\_t39\_tN\_tN\_\_l2
	rtn:compile 
\item[F30] 
11/27/17
- error with generated code -missing types\\
erorr:slice a tensor field [n]. missing n type declaration. 
fix:when we see evalShape(shape) then we addTy (Ty.TensorRefTy shape);
********** type difference
***rtn:compile \_\_p\_o32\_o1\_t7\_tN\_tN\_\_l2
	 -: neg(slicev1)
	-\_F\_v3\_d2 |p\_o32\_o1\_t7\_tN\_tN\_\_l2ex1.cxx:573:14: error: no member named 'tensor\_ref\_3' in namespace 'ex1'
        return(ex1::tensor\_ref\_3((double*) H));

	rtn:compile 
	\item[F31]
	-p\_o29\_o38\_t7 curl(slicem0)| F\_m3x3\_d3| \\
	rtn:terrible\\
λ(F0[3 3],FNCSPACE1,FNCSPACE2,T3[3])<Probe(BuildFEM(T0\_{'1',i0})\_1[2]∇\_{i1}),T3)>\_{3 3}\\
λ(F0[3 3],FNCSPACE1,FNCSPACE2,T3[3])<Probe(BuildFEM(T0\_{i2,i1})\_1[2]∇\_{i2}),T3)>\_{3 3 3}\\

shifting isn’t done correctly when there is a cut.
\item[F32]
F\_[0c] del\_1. Jacob M1.\\
constant is second index. missing case.\\
\item[F33]
compose(inverse)\\
-\_F\_m2x2\_d3,F\_v3\_d3 |p\_o8\_o36\_t6\_t20\_tN\_\_l2
Missing case for summation of a probe with composition in float. \\
\end{description}